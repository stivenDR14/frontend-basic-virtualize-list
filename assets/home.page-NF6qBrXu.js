import{j as e,M as l,U as I,R as y,V as L,S as w,r,A as k,N as h,W as j}from"./index-C6Wihg4f.js";import{u as C,a as M,C as T}from"./auth.hook-BLpA-1Ri.js";import{B as z}from"./Button-BxXTDD7I.js";function B(){const{logout:n,isLoading:s}=C();return e.jsx(l,{sx:{position:"fixed",top:16,left:16,zIndex:1100},children:e.jsx(z,{disabled:s,startIcon:s?e.jsx(y,{size:20,color:"inherit"}):null,variant:"contained",color:"primary",onClick:()=>n(),children:I.logout})})}const G={getRatingsWithCache:async()=>{try{const n=localStorage.getItem("ratings");if(n)return JSON.parse(n);{const s=await L.get("https://b6iwfeje7i.execute-api.us-east-1.amazonaws.com/prod/items");if(!s)throw new Error(w.errorEndpoint);return localStorage.setItem("ratings",JSON.stringify(s.data)),s.data}}catch{throw new Error(w.errorEndpoint)}}};function H({items:n,itemHeight:s}){const[p,x]=r.useState([]),[d,u]=r.useState(0),o=r.useRef(null),a=r.useCallback(()=>{o.current&&u(o.current.scrollTop)},[]);r.useEffect(()=>{if(n.length===0||!o.current)return;const c=1,f=o.current.clientHeight,m=Math.max(0,Math.floor(d/s)-c),v=Math.min(n.length-1,Math.ceil((d+f)/s)+c),b=n.slice(m,v+1);x(b)},[d,n]),r.useEffect(()=>{const c=o.current;return c&&(c.addEventListener("scroll",a),a()),()=>{c&&c.removeEventListener("scroll",a)}},[a,o.current]);const t=n.length*s,g=r.useCallback(c=>n.indexOf(c),[n]);return{containerRef:o,visibleItems:p,totalHeight:t,getItemIndex:g}}const R=()=>{const[n,s]=r.useState(!1),[p,x]=r.useState(!0),d=r.useCallback(u=>{const{scrollTop:o,scrollHeight:a,clientHeight:t}=u;s(o>10),x(o+t<a-10)},[]);return r.useEffect(()=>{const u=t=>{t.target instanceof HTMLDivElement&&d(t.target)},o=t=>{t&&(d(t),t.addEventListener("scroll",u))},a=new MutationObserver(()=>{const t=document.querySelector(".virtualized-container");t instanceof HTMLDivElement&&(o(t),a.disconnect())});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect();const t=document.querySelector(".virtualized-container");t instanceof HTMLDivElement&&t.removeEventListener("scroll",u)}},[d]),{showTopGradient:n,showBottomGradient:p}},_=()=>{const[n,s]=r.useState([]),[p,x]=r.useState(!0),[d,u]=r.useState(null),o=k(),t=M(o.breakpoints.up("md"))?216:166,{containerRef:g,visibleItems:c,totalHeight:f,getItemIndex:m}=H({items:n,itemHeight:t}),{showTopGradient:v,showBottomGradient:b}=R();return r.useEffect(()=>{G.getRatingsWithCache().then(i=>{s(i),x(!1)}).catch(()=>{u("Error loading ratings data"),x(!1)})},[]),p?e.jsx(l,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(y,{})}):d?e.jsx(l,{sx:{p:2},children:e.jsx(h,{color:"error",children:d})}):e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",height:"100vh"},children:[e.jsx(h,{variant:"h2",sx:{margin:2,marginTop:{xs:6,md:2}},children:j.reviews}),e.jsxs(l,{className:"virtualized-container",sx:{height:"100%",overflow:"auto",width:"100%",maxWidth:800,p:4,position:"relative"},ref:g,children:[e.jsx(l,{sx:{position:"sticky",top:"-32px",left:0,right:0,height:"60px",background:"linear-gradient(to bottom, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)",zIndex:2,display:v?"block":"none",transition:"opacity 0.3s ease",pointerEvents:"none"}}),e.jsx(l,{sx:{height:`${f}px`,position:"relative"},children:c.map((i,S)=>{const E=m(i)*t;return e.jsx(l,{sx:{position:"absolute",top:`${E}px`,width:"100%",height:`${t}px`},children:e.jsx(T,{isSmall:!0,ratingScore:i.review_rating,children:e.jsxs(l,{sx:{height:"100%"},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:e.jsx("strong",{children:i.product_name})}),e.jsx(h,{variant:"subtitle2",children:e.jsxs("strong",{children:[j.by," ",i.reviewer_name]})}),e.jsx(h,{variant:"body2",sx:{fontStyle:"italic"},children:i.review_title}),e.jsx(h,{variant:"body2",sx:{mt:1},children:i.review_text}),e.jsx(h,{variant:"caption",display:"block",sx:{mt:1},children:new Date(i.review_date).toLocaleDateString()}),e.jsx("a",{href:i.url,target:"_blank",children:j.link})]})})},`${i.product_name}-${i.reviewer_name}-${S}`)})}),e.jsx(l,{sx:{position:"sticky",bottom:"-32px",left:0,right:0,height:"60px",background:"linear-gradient(to top, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)",zIndex:2,display:b?"block":"none",transition:"opacity 0.3s ease",pointerEvents:"none"}})]})]})};function V(){return e.jsxs(l,{sx:{width:"100vw"},children:[e.jsx(B,{}),e.jsx(_,{})]})}export{V as default};
